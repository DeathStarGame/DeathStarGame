# http routing section
http:
  routers:
    # Define a connection between requests and services
    to-traefik:
      service: traefik
      rule: PathPrefix(`/traefik/`) || PathPrefix(`/api/`) || HeadersRegexp(`Referer`, `.*\/traefik\/dashboard\/.*`)
      middlewares:
        - "stripPrefix-traefik"
        # - "replacePath-traefik"
    to-ipfs-ui:
      service: ipfs
      # rule: "PathPrefix(`/ipfs/webui`)"
      rule: "PathPrefix(`/ipfs-ui`)"
      middlewares:
        - "replacePath-ipfs-ui"
       # If the rule matches, applies the middleware
      # middlewares:
      # - test-user
      # If the rule matches, forward to the whoami service (declared below)
  
  middlewares:
    stripPrefix-traefik:
      stripPrefix:
        prefixes: 
        - "/traefik"
    replacePath-traefik:
      replacePath:
        path: "/dashboard"
    replacePath-ipfs-ui:
      replacePath:
        path: "/webui"

  # middlewares:
  #   # Define an authentication mechanism
  #   test-user:
  #     basicAuth:
  #       users:
  #       - test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/

  services:
    # Define how to reach an existing service on our infrastructure
    ipfs:
      loadBalancer:
        servers:
        - url: http://ipfs:5001
    traefik:
      loadBalancer:
        servers:
        - url: http://traefik:8080