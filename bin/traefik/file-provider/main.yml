# http routing section
http:
  routers:
    # Define a connection between requests and services
    to-traefik:
      priority: 1
      service: traefik
      rule: PathPrefix(`/traefik/`) || PathPrefix(`/api/`) || HeadersRegexp(`Referer`, `.*\/traefik\/.*`)
      middlewares:
        - "stripPrefix-traefik"
        # - "replacePath-traefik"
    to-ipfs-ui:
      priority: 2
      service: ipfs-ui
      # rule: "PathPrefix(`/ipfs/webui`)"
      rule: PathPrefix(`/ipfs-ui/`) || PathPrefix(`/ipfs/`) || PathPrefix(`/api/`) || HeadersRegexp(`Referer`, `.*\/ipfs-ui\/.*`)
      middlewares:
        - "stripPrefix-ipfs-ui"
       # If the rule matches, applies the middleware
      # middlewares:
      # - test-user
      # If the rule matches, forward to the whoami service (declared below)
  
  middlewares:
    stripPrefix-traefik:
      stripPrefix:
        prefixes: 
        - "/traefik"
    stripPrefix-ipfs-ui:
      stripPrefix:
        prefixes: 
        - "/ipfs-ui"
    # replacePath-traefik:
    #   replacePath:
    #     path: "/dashboard"
    # replacePath-ipfs-ui:
    #   replacePath:
    #     path: "/webui"


  # middlewares:
  #   # Define an authentication mechanism
  #   test-user:
  #     basicAuth:
  #       users:
  #       - test:$apr1$H6uskkkW$IgXLP6ewTrSuBkTrqE8wj/

  services:
    # Define how to reach an existing service on our infrastructure
    ipfs-ui:
      loadBalancer:
        servers:
        - url: http://ipfs:5001
    traefik:
      loadBalancer:
        servers:
        - url: http://traefik:8080