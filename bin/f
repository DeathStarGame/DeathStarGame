#!/bin/bash

dev(){

  # lein repl :start :host 0.0.0.0 :port 7788
  # lein repl :headless :host 0.0.0.0 :port 7788
  # lein repl :connect 0.0.0.0:7878
  lein repl :headless

}

run_dev(){
  lein run dev
}

run_uberjar(){
  java -jar target/app.standalone.jar
}

uberjar(){
  lein with-profiles +prod uberjar
  # java -jar target/app.uber.jar 
}

native(){
  lein native-image
}

dock() {

    SUFFIX=$1
    IMAGE=deathstar
    NAME=deathstar-$SUFFIX
    REPL_PORT=77$SUFFIX$SUFFIX
    NETWORK=deathstar
    HOMEDIR_VOLUME=.user$SUFFIX
  
    docker build -t $IMAGE -f Dockerfile .
    docker network create $NETWORK
    docker run  --rm \
                --cpus=4.0 \
                --memory=8g \
                --name $NAME \
                -it \
                --network $NETWORK \
                -p $REPL_PORT:7788 \
                -v "$(pwd)/$HOMEDIR_VOLUME":/root \
                 $IMAGE \
                 bash
}

"$@"