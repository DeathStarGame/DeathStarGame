#!/bin/bash

dev(){

  # lein repl :start :host 0.0.0.0 :port 7788
  # lein repl :headless :host 0.0.0.0 :port 7788
  # lein repl :connect 0.0.0.0:7878
  lein repl :headless

}

run_dev(){
  lein run dev
}

run_uberjar(){
  java -jar target/app.standalone.jar
}

uberjar(){
  lein with-profiles +prod uberjar
  # java -jar target/app.uber.jar 
}

native(){
  lein native-image
}

dock_default() {

    INSTANCE_PATH=$1
    PORT=$2
    NAME=deathstar.worker.$1

    # WORKDIR_PATH=$VOLUME_PATH/deathstar/build/worker
    VOLUME_PATH1=/root/.deathstar/instances/$INSTANCE_PATH/repos
    WORKDIR_PATH=$VOLUME_PATH1/deathstar/build/worker

    docker build \
    --build-arg WORKDIR_PATH=$WORKDIR_PATH \
    -t $NAME \
    -f dev.Dockerfile .

    docker run  --rm \
                --cpus=4.0 \
                --memory=4g \
                --name $NAME \
                -it \
                -p $PORT:7788 \
                -p 7799:7799 \
                -p 8081:8080 \
                -v "$(cd ../../../ && pwd)":$VOLUME_PATH1 \
                -v "$(pwd)/.user":/root \
                 $NAME \
                 bash

  # -v "$(pwd)":/ctx/app \
  
}

dock(){
  dock_default instance0 2230
}

dock1(){
  dock_default player1 2231
}

dock2(){
  dock_default player2 2232
}


"$@"