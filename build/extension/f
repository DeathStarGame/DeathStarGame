#!/bin/bash

clean(){
    rm -rf resources/out out
}

purge(){
    clean
    rm -rf  .shadow-cljs .cpcache 
}

shadow(){
    ./node_modules/.bin/shadow-cljs "$@"
}

server(){
    shadow -A:dev server
    # yarn server
}

dev(){
    npm i
    shadow -A:dev watch \
    :extension \
    :extension-gui

    # npm i
    # shadow -A:dev watch \
    # :extension
}

tree(){
    clojure -A:dev:optimized -Stree
}

compile(){
    npm i
    shadow -A:dev compile  :extension :extension-bootstrap
}

dock() {

    docker build -t deathstar.ltee -f dev.Dockerfile .
    docker run  --rm \
                --cpus=4.0 \
                --memory=4g \
                --name deathstar.ltee \
                -it \
                -p 2200:2200 \
                -p 2201:2201 \
                -p 2202:2202 \
                -v "$(pwd)":/ctx/app \
                -v "$(cd ../../ && pwd)":/ctx/code \
                 deathstar.ltee \
                 bash
}


cljs_compile_extension(){
    clj -A:core:dev -m cljs.main -co build.edn -c deathstar.main
}

cljs_compile_tab_scenario(){
    clj -A:core:dev -m cljs.main -co build-tab-scenario.edn -v -c # -r
}

fwm(){
    clojure -A:core:dev \
    -m nrepl.cmdline  \
    --middleware "[cider.nrepl/cider-middleware cider.piggieback/wrap-cljs-repl]" \
    --bind "0.0.0.0" --port 5100
}

"$@"